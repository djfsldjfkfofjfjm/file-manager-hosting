<!DOCTYPE html>
<html>
<head>
    <title>Test File Upload</title>
</head>
<body>
    <h1>Test File Upload</h1>
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">Upload</button>
    <pre id="result"></pre>

    <script>
        let token = null;
        let projectId = null;

        async function login() {
            const response = await fetch('https://file-manager-chi.vercel.app/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: 'admin',
                    password: 'secure_password_123'
                })
            });
            const data = await response.json();
            console.log('Login response:', data);
            
            // Get cookie from response
            const cookies = document.cookie;
            console.log('Cookies:', cookies);
            
            // Create a project
            const projectResponse = await fetch('https://file-manager-chi.vercel.app/api/projects', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include',
                body: JSON.stringify({
                    name: 'Test Project',
                    description: 'Test project for file upload'
                })
            });
            
            if (projectResponse.ok) {
                const project = await projectResponse.json();
                projectId = project.id;
                console.log('Created project:', project);
            } else {
                console.error('Failed to create project:', await projectResponse.text());
            }
        }

        async function uploadFile() {
            if (!projectId) {
                await login();
            }
            
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('projectId', projectId);
            
            try {
                const response = await fetch('https://file-manager-chi.vercel.app/api/files/upload', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });
                
                const data = await response.json();
                document.getElementById('result').textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    console.log('Upload successful:', data);
                } else {
                    console.error('Upload failed:', data);
                }
            } catch (error) {
                console.error('Upload error:', error);
                document.getElementById('result').textContent = 'Error: ' + error.message;
            }
        }
        
        // Auto-login on page load
        login();
    </script>
</body>
</html>